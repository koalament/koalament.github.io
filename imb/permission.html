<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
<style>
    body {
        font-family: 'Roboto', sans-serif;
        background: url('./assets/images/bg.svg');
        font-size: 36px;
        color: #363636;
    }

    .container{
        margin-top: 100px;
        margin-left: 20%;
    }
    
    .body {
        font-size: 18px;
        line-height: 21px;
        color: #757575;
        max-width: 419px;
        margin-top: 27px;
        margin-bottom: 64px;
    }

    .button>button {
        padding: 16px 34px;
        border: 2px solid #212121;
        box-sizing: border-box;
        border-radius: 50px;
        background: inherit;
        cursor: pointer;
    }
    .button>button:focus {
        outline: 0;
    }
</style>

<section class="container">
    <section class="header">
        <svg style="vertical-align: middle;" width="80" height="80" viewBox="0 0 80 80" fill="none"
            xmlns="http://www.w3.org/2000/svg">
            <g clip-path="url(#clip0)">
                <path
                    d="M30.8594 43.1406C32.2703 43.1406 33.4141 41.9969 33.4141 40.5859C33.4141 39.175 32.2703 38.0312 30.8594 38.0312C29.4485 38.0312 28.3047 39.175 28.3047 40.5859C28.3047 41.9969 29.4485 43.1406 30.8594 43.1406Z"
                    fill="#E9B200" />
                <path
                    d="M30.8594 42.3203C29.9141 42.3203 29.1406 41.5469 29.1406 40.6016C29.1406 39.6563 29.9141 38.8828 30.8594 38.8828C31.8047 38.8828 32.5781 39.6563 32.5781 40.6016C32.5781 41.5469 31.8047 42.3203 30.8594 42.3203ZM30.8594 40.125C30.6016 40.125 30.3906 40.3359 30.3906 40.5938C30.3906 40.8516 30.6016 41.0625 30.8594 41.0625C31.1172 41.0625 31.3281 40.8516 31.3281 40.5938C31.3281 40.3359 31.1172 40.125 30.8594 40.125Z"
                    fill="#323232" />
                <path
                    d="M48.8438 43.1406C50.2547 43.1406 51.3984 41.9969 51.3984 40.5859C51.3984 39.175 50.2547 38.0312 48.8438 38.0312C47.4328 38.0312 46.2891 39.175 46.2891 40.5859C46.2891 41.9969 47.4328 43.1406 48.8438 43.1406Z"
                    fill="#E9B200" />
                <path
                    d="M48.8438 42.3203C47.8984 42.3203 47.125 41.5469 47.125 40.6016C47.125 39.6563 47.8984 38.8828 48.8438 38.8828C49.7891 38.8828 50.5625 39.6563 50.5625 40.6016C50.5703 41.5469 49.7969 42.3203 48.8438 42.3203ZM48.8438 40.125C48.5859 40.125 48.375 40.3359 48.375 40.5938C48.375 40.8516 48.5859 41.0625 48.8438 41.0625C49.1016 41.0625 49.3125 40.8516 49.3125 40.5938C49.3125 40.3359 49.1016 40.125 48.8438 40.125Z"
                    fill="#323232" />
                <path
                    d="M45.3203 52.1484V52.25C45.3203 55.2734 42.8672 57.7266 39.8438 57.7266C36.8516 57.7266 34.4219 55.3281 34.375 52.3516V52.2578C34.375 52.0625 34.3984 51.9062 34.4375 51.7812C34.4531 51.7344 34.4688 51.6953 34.4922 51.6563C34.6875 51.25 35.1094 50.9766 35.5859 50.9766C35.6797 50.9766 35.7656 50.9844 35.8437 51.0078C36.3516 52.7422 37.9531 54.0156 39.8516 54.0156C41.7422 54.0156 43.3438 52.7422 43.8516 51.0078C43.9297 50.9844 44.0156 50.9766 44.1016 50.9766C44.6641 50.9766 45.1328 51.3516 45.2734 51.8672C45.2734 51.875 45.2812 51.875 45.2812 51.8828C45.2891 51.9062 45.2969 51.9297 45.2969 51.9453C45.2969 51.9609 45.3047 51.9688 45.3047 51.9844C45.3125 52.0313 45.3203 52.0859 45.3203 52.1484Z"
                    fill="#E9B200" />
                <path
                    d="M39.8516 54.4219C37.5859 54.4219 35.7266 52.5625 35.7266 50.2969V41.6328C35.7266 39.3672 37.5859 37.5078 39.8516 37.5078C42.1172 37.5078 43.9766 39.3672 43.9766 41.6328V50.2969C43.9766 52.5625 42.125 54.4219 39.8516 54.4219Z"
                    fill="#323232" />
                <path
                    d="M31.625 22.3359C31.625 22.4922 31.625 23 31.4219 23.6094C31.0938 24.6094 30.4219 25.25 30.1094 25.5156C30.0938 25.5234 30.1406 25.4922 30.1094 25.5156C25.4922 29.2891 22.6484 33.9063 21.875 41.4844C21.6953 43.2266 20.2266 44.5781 18.4375 44.5781C17.7891 44.5781 17.1875 44.3906 16.6563 44.0859C16.5938 44.0469 16.5313 44.0078 16.4609 43.9609C12.6016 41.3672 10 37.0313 10 32.0469C10 24.1641 16.4453 17.7656 24.3828 17.7656C25.8359 17.7656 27.4453 17.9063 28.9375 18.5C30.5078 19.0703 31.625 20.5703 31.625 22.3359Z"
                    fill="#323232" />
                <path
                    d="M26.6563 26.3984C26.6563 26.4844 26.6562 26.7578 26.5469 27.0859C26.3672 27.625 26.0078 27.9687 25.8359 28.1172C25.8281 28.125 25.8516 28.1016 25.8359 28.1172C23.3438 30.1562 21.8047 32.6562 21.3906 36.75C21.2969 37.6875 20.5 38.4219 19.5313 38.4219C19.1797 38.4219 18.8516 38.3203 18.5703 38.1562C18.5313 38.1328 18.5 38.1172 18.4688 38.0859C16.375 36.6797 14.9766 34.3359 14.9766 31.6406C14.9766 27.3828 18.4609 23.9219 22.75 23.9219C23.5313 23.9219 24.4063 24 25.2109 24.3203C26.0547 24.6328 26.6563 25.4453 26.6563 26.3984Z"
                    fill="#E9B200" />
                <path
                    d="M48.375 22.3359C48.375 22.4922 48.375 23 48.5781 23.6094C48.9062 24.6094 49.5781 25.25 49.8906 25.5156C49.9062 25.5234 49.8594 25.4922 49.8906 25.5156C54.5078 29.2891 57.3516 33.9063 58.125 41.4844C58.3047 43.2266 59.7734 44.5781 61.5625 44.5781C62.2109 44.5781 62.8125 44.3906 63.3437 44.0859C63.4062 44.0469 63.4687 44.0078 63.5391 43.9609C67.4062 41.3672 70 37.0313 70 32.0469C70 24.1641 63.5547 17.7656 55.6172 17.7656C54.1641 17.7656 52.5547 17.9063 51.0625 18.5C49.4922 19.0703 48.375 20.5703 48.375 22.3359Z"
                    fill="#323232" />
                <path
                    d="M53.3438 26.3984C53.3438 26.4844 53.3438 26.7578 53.4531 27.0859C53.6328 27.625 53.9922 27.9687 54.1641 28.1172C54.1719 28.125 54.1484 28.1016 54.1641 28.1172C56.6563 30.1562 58.1953 32.6562 58.6094 36.75C58.7031 37.6875 59.5 38.4219 60.4688 38.4219C60.8203 38.4219 61.1484 38.3203 61.4297 38.1562C61.4688 38.1328 61.5 38.1172 61.5313 38.0859C63.625 36.6797 65.0235 34.3359 65.0235 31.6406C65.0235 27.3828 61.5391 23.9219 57.25 23.9219C56.4688 23.9219 55.5938 24 54.7891 24.3203C53.9531 24.6328 53.3438 25.4453 53.3438 26.3984Z"
                    fill="#E9B200" />
            </g>
            <defs>
                <clipPath id="clip0">
                    <rect width="80" height="80" fill="white" />
                </clipPath>
            </defs>
        </svg>
        Koalament
    </section>
    <section class="body">
        You were redirected to this page because you are enabling Invisible Money Button(IMB). It allows us to spend up
        to $5 from your account for the actions you take with the Koalament service.
    </section>
    <section class="button">
        <button onclick="permission()">
            Refresh
            <svg style="vertical-align: middle;" width="24" height="24" viewBox="0 0 24 24" fill="none"
                xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M17.6459 6.35C16.1959 4.9 14.2059 4 11.9959 4C7.57586 4 4.00586 7.58 4.00586 12C4.00586 16.42 7.57586 20 11.9959 20C15.7259 20 18.8359 17.45 19.7259 14H17.6459C16.8259 16.33 14.6059 18 11.9959 18C8.68586 18 5.99586 15.31 5.99586 12C5.99586 8.69 8.68586 6 11.9959 6C13.6559 6 15.1359 6.69 16.2159 7.78L12.9959 11H19.9959V4L17.6459 6.35Z"
                    fill="#212121" />
            </svg>

        </button>
    </section>
</section>

<script src="https://www.moneybutton.com/moneybutton.js"></script>


<script>
    function permission() {
        return new Promise((resolve, reject) => {
            let config = {
                clientIdentifier: '239e069cd23397c56326391d6337bfc1',
                onNewPermissionGranted: (token) => savePermissionToken(token)
            };
            const imb = new moneyButton.IMB(config);
            imb.swipe().then(
                ({
                    payment
                }) => {
                    resolve(payment)
                },
                error => console.log(error)
            )
        });
    }

    function savePermissionToken(token) {
        if (typeof chrome !== "undefined") {
            chrome.runtime.sendMessage('hopnmkhglmbpmgbjcccjpdekogkflffe', {
                command: "register_IMB_token",
                token: token
            },
                function (response) {
                    if (response.status === 'ok') {
                        // window.close();
                    }
                });
            console.log(token);
        } else {

            // firefox support browser
            window.postMessage({
                command: "register_IMB_token",
                token: token
            }, "*");
            console.log(token);
        }
    }
    permission();
</script>
